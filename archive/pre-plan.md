# План разработки карты точек показа рекламы

## Общая информация

| Параметр | Значение |
|----------|----------|
| Точек | 2 375 |
| Регионов | 191 (требуется нормализация) |
| Брендов | 98 (требуется объединение) |
| Стек | HTML + CSS + JavaScript |
| Карты | Яндекс Maps API 3.0 |

---

## Этап 1. Подготовка данных

### 1.1 Нормализация регионов

**Проблема**: смешаны города и области (`Жуковский` vs `Московская обл`)

**Решение**: двухуровневая структура

```
Регион (область/край/республика)
└── Город / Населённый пункт / Трасса
```

**Задачи**:
- [ ] Составить справочник соответствий город → регион
- [ ] Определить, какие точки на трассах (адрес без города)
- [ ] Присвоить каждой точке `regionId` и `cityId`

**Пример результата**:
```json
{
    "regionId": "moscow-oblast",
    "regionName": "Московская область", 
    "city": "Жуковский",
    "isHighway": false
}
```

### 1.2 Объединение брендов

**Проблема**: дубли и вариации

| Текущее | Объединить в |
|---------|--------------|
| `Мария-Ра`, `Мария-ра` | `Мария-Ра` |
| `Солнечный круг СК-1` ... `СК-18` | `Солнечный круг` |
| `ЛЕНТА Гипермаркет`, `ЛЕНТА Гипермаркет Эконом` | `Лента` |
| `Eurospar`, `Eurospar (ТЦ ...)` | `Eurospar` |
| `Победа`, `Победа (ТЦ ...)` | `Победа` |

**Задачи**:
- [ ] Составить справочник нормализации брендов
- [ ] Решить: ТЦ — это отдельный бренд или категория?
- [ ] Присвоить каждой точке `brandId` и `brandName`

### 1.3 Геокодирование адресов

**Инструмент**: Яндекс Геокодер API

**Задачи**:
- [ ] Написать скрипт геокодирования
- [ ] Прогнать все 2375 адресов
- [ ] Выгрузить отчёт о проблемных адресах (не найдены / низкая точность)
- [ ] Вручную проверить/исправить проблемные (ожидаю 5-15%)

**Лимиты API**: 1000 бесплатных запросов/день → 3 дня на геокодирование или платный тариф

### 1.4 Формирование итогового JSON

**Структура данных**:

```json
{
    "points": [
        {
            "id": "point-001",
            "coords": [55.7558, 37.6173],
            "address": "г. Жуковский, ул. Фрунзе, 1б",
            "brand": {
                "id": "verniy",
                "name": "Верный"
            },
            "region": {
                "id": "moscow-oblast",
                "name": "Московская область"
            },
            "city": "Жуковский",
            "price": 10210,
            "contacts": 30000,
            "hours": "08:00 - 22:00"
        }
    ],
    "filters": {
        "regions": [
            { "id": "moscow", "name": "Москва", "count": 245 },
            { "id": "moscow-oblast", "name": "Московская область", "count": 312 }
        ],
        "brands": [
            { "id": "verniy", "name": "Верный", "count": 156 },
            { "id": "lenta", "name": "Лента", "count": 89 }
        ]
    },
    "meta": {
        "totalPoints": 2375,
        "generatedAt": "2026-01-25",
        "pricesPeriod": "01.02.2026 - 28.02.2026"
    }
}
```

---

## Этап 2. Разработка интерфейса

### 2.1 Структура страницы

```
┌────────────────────────────────────────────────────────┐
│  Шапка: логотип + заголовок                            │
├───────────────┬────────────────────────────────────────┤
│               │                                        │
│   Фильтры     │              Карта                     │
│               │                                        │
│  ┌─────────┐  │         [Яндекс.Карты]                 │
│  │ Регион ▼│  │                                        │
│  └─────────┘  │           + кластеры                   │
│               │           + метки                      │
│  ┌─────────┐  │                                        │
│  │ Бренд  ▼│  │                                        │
│  └─────────┘  │                                        │
│               │                                        │
│  Найдено: 245 │                                        │
│               │                                        │
│  [Сбросить]   │                                        │
│               │                                        │
└───────────────┴────────────────────────────────────────┘
```

### 2.2 Компоненты

| Компонент | Описание |
|-----------|----------|
| **Карта** | Яндекс Maps + кластеризация (обязательно при 2000+ точек) |
| **Фильтр региона** | Select / Dropdown, один выбор |
| **Фильтр бренда** | Select / Dropdown, один выбор |
| **Счётчик** | Показывает количество отфильтрованных точек |
| **Балун** | Popup с информацией о точке при клике |

### 2.3 Балун (popup) точки

```
┌─────────────────────────┐
│ Верный                  │
│ ул. Фрунзе, 1б          │
│ Жуковский               │
├─────────────────────────┤
│ Цена: 10 210 ₽/мес      │
│ Контактов: 30 000       │
│ Часы: 08:00 - 22:00     │
└─────────────────────────┘
```

---

## Этап 3. Техническая реализация

### 3.1 Файловая структура

```
ad-map/
├── index.html
├── css/
│   └── style.css
├── js/
│   ├── app.js          # Основная логика
│   ├── map.js          # Работа с картой
│   └── filters.js      # Логика фильтрации
├── data/
│   └── points.json     # Данные точек
└── assets/
    └── markers/        # Иконки меток (опционально)
```

### 3.2 Зависимости

| Библиотека | Версия | Назначение |
|------------|--------|------------|
| Яндекс Maps API | 3.0 | Карта, метки, кластеризация |
| — | — | Без фреймворков, чистый JS |

### 3.3 Ключевые технические решения

| Задача | Решение |
|--------|---------|
| 2000+ точек | Кластеризация через `ymaps3.YMapClusterer` |
| Фильтрация | Фильтрация массива в памяти, перерисовка меток |
| Производительность | Ленивая загрузка балунов, debounce на фильтрах |
| Мобильная версия | Адаптивный layout, фильтры в drawer |

---

## Этап 4. Тестирование и деплой

### 4.1 Тестирование

- [ ] Проверка всех комбинаций фильтров
- [ ] Проверка на мобильных устройствах
- [ ] Проверка производительности (2000+ точек)
- [ ] Проверка корректности координат (выборочно 20-30 точек)

### 4.2 Деплой

- [ ] Статический хостинг (любой: Netlify, GitHub Pages, свой сервер)
- [ ] Ограничение API-ключа по домену

---

## Оценка времени

| Этап | Задача | Время |
|------|--------|-------|
| 1.1 | Нормализация регионов | 2-3 ч |
| 1.2 | Объединение брендов | 1-2 ч |
| 1.3 | Геокодирование + проверка | 4-6 ч |
| 1.4 | Формирование JSON | 1 ч |
| 2 | Вёрстка интерфейса | 3-4 ч |
| 3 | Логика карты и фильтров | 4-6 ч |
| 4 | Тестирование и правки | 2-3 ч |
| **Итого** | | **17-25 ч** |

---

## Открытые вопросы

1. **Дизайн:**
    - Делаем минималистично, есть хедер-футер сервиса, где будет размещен лендинг

2. **Обновление данных:**
    - Как часто будут добавляться точки? *Ответ:* несколько обновления раз в месяц
    - Как будут обновляться данные? *Ответ:* в идеале через гугл-таблицу, пока не ясно как
