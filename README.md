# Карта точек показа рекламы

Интерактивная карта для отображения точек размещения рекламы (аудиореклама в магазинах) с использованием Яндекс Карт API 3.0.

## Технологии

- **Frontend**: HTML5, CSS3, Vanilla JavaScript (ES6 модули)
- **Карты**: Яндекс Карты API 3.0
- **Скрипты обработки данных**: Python 3 (pandas, requests)
- **Без фреймворков** — чистый JavaScript для максимальной производительности

## Возможности

- Отображение точек на карте с маркерами
- Фильтрация по региону и бренду с двусторонней зависимостью
- Автоматический zoom к выбранному региону
- Сохранение состояния фильтров в URL (поддержка кнопок назад/вперёд)
- Кэширование данных в localStorage
- Адаптивный дизайн (мобильная версия)
- Popup с информацией о точке (цена, контакты, часы работы)

## Структура проекта

```
.
├── app/                          # Веб-приложение
│   ├── index.html                # Главная страница
│   ├── css/
│   │   └── style.css             # Стили
│   ├── js/
│   │   ├── app.js                # Главный модуль
│   │   ├── map.js                # Работа с Яндекс Картами
│   │   ├── filters.js            # Логика фильтров
│   │   ├── url-state.js          # Синхронизация с URL
│   │   └── cache.js              # Кэширование данных
│   ├── data/
│   │   ├── map_prices.csv        # Исходные данные (редактируемый)
│   │   ├── points.json           # Сгенерированный JSON для приложения
│   │   └── mappings/
│   │       ├── region-mapping.json   # Нормализация регионов
│   │       └── brand-mapping.json    # Группировка брендов
│   └── assets/
│       └── yradio-logo.svg       # Логотип
└── scripts/                      # Python-скрипты
    ├── build_json.py             # Генерация points.json из CSV
    └── geocode.py                # Геокодирование адресов
```

## Запуск локально

### Требования

- Современный браузер (Chrome, Firefox, Safari, Edge)
- Локальный веб-сервер (необходим для ES6 модулей)
- Python 3.8+ (для скриптов обработки данных)

### Установка

1. Клонируйте репозиторий:
```bash
git clone git@github.com:klimsergeev/yradio-map.git
cd yradio-map
```

2. Установите зависимости Python (для работы со скриптами):
```bash
pip install pandas requests
```

3. Запустите локальный сервер из папки `app`:
```bash
# Вариант 1: Python
cd app
python -m http.server 8080

# Вариант 2: Node.js (если установлен)
npx serve app

# Вариант 3: VS Code Live Server
# Откройте app/index.html и нажмите "Go Live"
```

4. Откройте в браузере: http://localhost:8080

## Работа с данными

### Исходные данные

Основной файл данных — `app/data/map_prices.csv`. Это CSV-файл с точками рекламы.

**Структура CSV:**
| Колонка | Описание |
|---------|----------|
| Регион | Название региона/города |
| Адрес | Адрес точки |
| Название | Название бренда/сети |
| Цена | Цена размещения (руб/мес) |
| Контактов / мес | Количество контактов в месяц |
| Интенсивность выхода | Частота показа (каждые N минут) |
| Часы работы | Время работы точки |
| Выходов / мес | Количество показов в месяц |
| lat | Широта (может заполняться геокодером) |
| lon | Долгота (может заполняться геокодером) |

### Маппинги

- `region-mapping.json` — нормализация регионов (объединение вариантов написания)
- `brand-mapping.json` — группировка брендов

### Генерация JSON

После редактирования CSV-файла необходимо сгенерировать `points.json`:

```bash
python scripts/build_json.py
```

Скрипт:
- Читает данные из CSV
- Применяет маппинги для нормализации
- Формирует структуру с точками и списками фильтров
- Сохраняет результат в `app/data/points.json`

### Геокодирование

Если в CSV добавлены новые адреса без координат, запустите геокодер:

```bash
python scripts/geocode.py
```

Скрипт:
- Находит строки без координат
- Геокодирует адреса через Яндекс Геокодер API
- Обновляет колонки lat/lon в CSV
- Сохраняет прогресс каждые 50 записей

**Важно:** После геокодирования нужно запустить `build_json.py` для обновления JSON.

## GitHub Pages

Проект размещён на GitHub Pages:

https://klimsergeev.github.io/yradio-map/
